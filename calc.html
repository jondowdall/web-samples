<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width" />
  <title>calculator</title>
  <style>
html {
    font-family: sans-serif;
  height: -webkit-fill-available;
}

.active {
    background: lightyellow;
}

.replace {
    background: pink;
}

.function, .action {
    border: 2px outset lightblue;
    border-radius: 0.5em;
    text-align: center;
    vertical-align: middle;
    font-size: 200%;
    line-height: 2em;
    /*box-shadow: 0.5em 0.5em 0.6em 0.3em rgba(150, 150, 150, 0.8);*/
    box-shadow: 5px 5px 6px 3px rgba(150, 150, 150, 0.8);
}

sup, sub {
    font-size: 50%;
}

.function {
    background: darkblue;
    color: lightblue;
    margin: 3px;
}

.action {
    background: linear-gradient(170deg, darkblue, lightblue 75%, blue);
    color: white;
    margin: 3px;

}

#layout {
    border: none;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    display: grid;
    grid-template-rows: min-content 1fr 1fr min-content repeat(8, 1fr);
    grid-template-columns: repeat(3, 1fr) repeat(4, 1fr);
    min-height: -webkit-fill-available;
}

#status {
    grid-column: 1 / -1;
    grid-row: 1 / 2;
}


#expression {
    grid-column: 1 / -1;
    grid-row: 2 / 3;
    font-size: 200%;
}

#sub-answer {
    grid-column: 1 / 4;
    grid-row: 3 / 4;
    padding: 0 0.5em;
}

#answer {
    grid-column: 4 / -1;
    grid-row: 3 / 4;
    text-align: right;
    font-size: 200%;
    padding: 0 0.5em;
}

#settings {
    grid-column: 1 / -1;
    grid-row: 4 / 5;
}

#buttons {
    grid-column: 1 / -1;
    grid-row: 5 / -1;
}

#open-brace {
    grid-column: 1 / 2;
    grid-row: 5 / 6;
}

#close-brace {
    grid-column: 2 / 3;
    grid-row: 5 / 6;
}

#sign {
    grid-column: 1 / 2;
    grid-row: 11 / 12;
}

#square {
    grid-column: 1 / 2;
    grid-row: 7 / 8;
}

#cube {
    grid-column: 2 / 3;
    grid-row: 7 / 8;
}

#power {
    grid-column: 3 / 4;
    grid-row: 7 / 8;
}

#square-root {
    grid-column: 4 / 5;
    grid-row: 7 / 8;
}

#cube-root {
    grid-column: 5 / 6;
    grid-row: 7 / 8;
}

#root {
    grid-column: 6 / 7;
    grid-row: 7 / 8;
}

#del {
    grid-column: 7 / 8;
    grid-row: 7 / 8;
}

#sin {
    grid-column: 1 / 2;
    grid-row: 8 / 9;
}

#cos {
    grid-column: 2 / 3;
    grid-row: 8 / 9;
}

#tan {
    grid-column: 3 / 4;
    grid-row: 8 / 9;
}

#sinh {
    grid-column: 1 / 2;
    grid-row: 9 / 10;
}

#cosh {
    grid-column: 2 / 3;
    grid-row: 9 / 10;
}

#tanh {
    grid-column: 3 / 4;
    grid-row: 9 / 10;
}

#ln {
    grid-column: 1 / 2;
    grid-row: 10 / 11;
}

#exp {
    grid-column: 2 / 3;
    grid-row: 10 / 11;
}

#log {
    grid-column: 3 / 4;
    grid-row: 10 / 11;
}

#collapse {
    grid-column: 1 / 2;
    grid-row: 6 / 7;
}

#edit {
    grid-column: 2 / 3;
    grid-row: 6 / 7;
}

#left {
    grid-column: 3 / 4;
    grid-row: 6 / 7;
}

#up {
    grid-column: 4 / 5;
    grid-row: 6 / 7;
}

#down {
    grid-column: 5 / 6;
    grid-row: 6 / 7;
}

#right {
    grid-column: 6 / 7;
    grid-row: 6 / 7;
}

#ee {
    grid-column: 7 / 8;
    grid-row: 6 / 7;
}

#inv {
    grid-column: 2 / 3;
    grid-row: 11 / 12;
}

#e {
    grid-column: 3 / 4;
    grid-row: 11 / 12;
}

#alt {
    grid-column: 1 / 2;
    grid-row: 12 / 13;
}

#angle {
    grid-column: 2 / 3;
    grid-row: 12 / 13;
}

#pi {
    grid-column: 3 / 4;
    grid-row: 12 / 13;
}


#clear {
    grid-column: 4 / 5;
    grid-row: 8 / 9;
}

#percent {
    grid-column: 5 / 6;
    grid-row: 8 / 9;
}

#divide {
    grid-column: 6 / 7;
    grid-row: 8 / 9;
}

#multiply {
    grid-column: 7 / 8;
    grid-row: 8 / 9;
}

#seven {
    grid-column: 4 / 5;
    grid-row: 9 / 10;
}

#eight {
    grid-column: 5 / 6;
    grid-row: 9 / 10;
}

#nine {
    grid-column: 6 / 7;
    grid-row: 9 / 10;
}

#minus {
    grid-column: 7 / 8;
    grid-row: 9 / 10;
}

#four {
    grid-column: 4 / 5;
    grid-row: 10 / 11;
}

#five {
    grid-column: 5 / 6;
    grid-row: 10 / 11;
}

#six {
    grid-column: 6 / 7;
    grid-row: 10 / 11;
}

#plus {
    grid-column: 7 / 8;
    grid-row: 10 / 11;
}

#one {
    grid-column: 4 / 5;
    grid-row: 11 / 12;
}

#two {
    grid-column: 5 / 6;
    grid-row: 11 / 12;
}

#three {
    grid-column: 6 / 7;
    grid-row: 11 / 12;
}

#equal {
    grid-column: 7 / 8;
    grid-row: 11 / 12;
}

#zero {
    grid-column: 4 / 6;
    grid-row: 12 / 13;
}

#decimal {
    grid-column: 6 / 7;
    grid-row: 12 / 13;
}

#enter {
    grid-column: 7 / 8;
    grid-row: 12 / 13;
}
 .collapsed {
    font-weight: bold;
    color: blue;
}
  </style>
</head>
<body>
  <div id="layout">
   <div id="status"></div>
   <div id="expression"></div>
   <div id="sub-answer"></div>
   <div id="answer"></div>
   <div id="settings"></div>
   <div id="buttons"></div>
   <div id="open-brace" class="function">(</div>
   <div id="close-brace" class="function">)</div>
   <div id="sign" class="function"><sup>+</sup>/<sub>&#8722</sub></div>
   <div id="square" class="function">x<sup>2</sup></div>
   <div id="cube" class="function">x<sup>3</sup></div>
   <div id="power" class="function">x<sup>y</sup></div>
   <div id="square-root" class="function">&#8730x</div>
   <div id="cube-root" class="function">&#8731x</div>
   <div id="root" class="function"><sup>y</sup>&#8730x</div>
   <div id="collapse" class="function">&asymp;</div>
   <div id="edit" class="function">&#9999;</div>
   <div id="left" class="function">&larr;</div>
   <div id="up" class="function">&uarr;</div>
   <div id="down" class="function">&darr;</div>
   <div id="right" class="function">&rarr;</div>
   <div id="ee" class="function">EE</div>
   <div id="del" class="action">Del</div>
   <div id="sin" class="function">sin</div>
   <div id="cos" class="function">cos</div>
   <div id="tan" class="function">tan</div>
   <div id="sinh" class="function">sinh</div>
   <div id="cosh" class="function">cosh</div>
   <div id="tanh" class="function">tanh</div>
   <div id="ln" class="function">ln</div>
   <div id="exp" class="function">10<sup>x</sup></div>
   <div id="log" class="function">log</div>
   <div id="inv" class="function"><sup>1</sup>/<sub>x</sub></div>
   <div id="e" class="function">e<sup>x</sup></div>
   <div id="alt" class="function">alt</div>
   <div id="angle" class="function">deg</div>
   <div id="pi" class="function">	&#960</div>

   <div id="clear" class="action">C</div>
   <div id="percent" class="action">%</div>
   <div id="divide" class="action">&#247</div>
   <div id="multiply" class="action">&#215</div>
   <div id="seven" class="action">7</div>
   <div id="eight" class="action">8</div>
   <div id="nine" class="action">9</div>
   <div id="minus" class="action">&#8722</div>
   <div id="four" class="action">4</div>
   <div id="five" class="action">5</div>
   <div id="six" class="action">6</div>
   <div id="plus" class="action">+</div>
   <div id="one" class="action">1</div>
   <div id="two" class="action">2</div>
   <div id="three" class="action">3</div>
   <div id="equal" class="action">=</div>
   <div id="zero" class="action">0</div>
   <div id="decimal" class="action">.</div>
   <div id="enter" class="action">&#9166;</div>

<script>
addEventListener('load', function(e) {
    addButtonActions();
    addKeyActions();
});

let angleScale = Math.PI / 180;
let angleUnits = 'deg';
let altMode = false;
const stack = [];
const precision = (value, places) => Math.round(value * Math.pow(10, places)) / Math.pow(10, places);

function newExpression(value=null) {
    return {
        input: [],
        value: value,
        decimal: (value && Math.trunc(value) !== value) ? (value + '').replace(/^[0-9]*\./, '').length : 0,
        valueOf() {
            return this.value || 0;
        },
        asString() {
            return this.value === null ? '_' : `${this.value}`;
        },
        addDigit(digit) {
            if (replace) {
                this.value = digit;
                this.decimal = 0;
                replace = false;
            } else {
                this.value = this.value || 0;
                if (this.decimal) {
                    this.value += digit * Math.pow(10, -this.decimal);
                    this.decimal += 1;
                } else {
                    this.value = this.value * 10 + digit;
                }
            }
        },
        htmlNodes() {
            return this.asString();
        },
    };
}

function unaryOperator(name, evaluate, asString, prefix, postfix) {
    let input = [newNode(active.expression, active)];
    if (replace && active.expression.input.length === 1) {
        input = [active.expression.input[0]];
    }
    
    const expression = {
        name,
        input,
        valueOf() {
            return evaluate(this.input[0].expression);
        },
        asString() {
            return asString(this.input[0].asString);
        },
        addDigit(digit) {
            if (replace) {
                active.expression = newExpression(digit);
                replace = false;
            } else {
                const symbol = document.createElement('span');
                symbol.innerHTML = ' &#xD7; ';
                binaryOperator(
                    'multiply',
                    (value1, value2) => value1 * value2,
                    (str1, str2) => `${str1} &#xD7; ${str2}`,
                    '(', symbol, ')');
                active.expression.input = [active.expression.input[1], active.expression.input[0]];
                active = active.expression.input[0];
                active.expression.addDigit(digit);
            }
        },
        htmlNodes() {
            const fragment = document.createDocumentFragment();
            if (prefix) {
                fragment.append(prefix);
            }
            fragment.append(this.input[0].getNode());
            if (postfix) {
                fragment.append(postfix);
            }
            return fragment;
        },
    };
    active.expression = expression;
    if (expression.input[0].expression.value === null) {
        active = active.expression.input[0];
    }
    replace = false;
    return expression;
}

function binaryOperator(name, evaluate, asString, prefix, operator, postfix) {
    let input = [newNode(active.expression, active), newNode(undefined, active)];
    if (replace && active.expression.input.length === 2) {
        input = [active.expression.input[0], active.expression.input[1]];
    }
    
    const expression = {
        name,
        input,
        valueOf() {
            return evaluate(this.input[0].expression, this.input[1].expression);
        },
        asString() {
            return asString(this.input[0].asString, this.input[1].asString);
        },
        addDigit(digit) {
            if (replace) {
                active.expression = newExpression(digit);
                replace = false;
            } else {
                active.expression = {
                   input: [newNode(newExpression(digit), active), newNode(active.expression, active)],
                   evaluate() {
                       return this.input[0].expression * this.input[1].expression;
                   },
                   valueOf() {
                       return this.evaluate();
                   },
                   asString() {
                       return `${this.input[0].expression.asString()} &#xD7; ${this.input[1].expression.asString()}`;
                   },
                   htmlNodes() {
                       const fragment = document.createDocumentFragment();
                       fragment.append('(');
                       fragment.append(this.input[0].getNode());
                       const symbol = document.createElement('span');
                       fragment.append(symbol);
                       symbol.innerHTML = ' &#xD7; ';
                       fragment.append(this.input[1].getNode());
                       fragment.append(')');
                       return fragment;
                   },
               };
               active = active.expression.input[0];
            }
        },
        htmlNodes() {
            const fragment = document.createDocumentFragment();
            if (prefix) {
                fragment.append(prefix);
            }
            fragment.append(this.input[0].getNode());
            if (operator) {
                fragment.append(operator);
            }
            fragment.append(this.input[1].getNode());
            if (postfix) {
                fragment.append(postfix);
            }
            return fragment;
        },
    };
    active.expression = expression;
    replace = false;
    return expression;
}


function newNode(expression=newExpression(), parent) {
    const newNode = {
        parent,
        expression: expression || newExpression(),
        node: document.createElement('span'),
        getNode() {
            this.node.innerHTML = '';
            if (this.collapsed) {
                this.node.innerHTML = `<span class="collapsed">${this.expression.valueOf()}</span>`;
            } else {
                this.node.append(this.expression.htmlNodes());
            }
            return this.node;
        },
    };
    expression.node = newNode;
    newNode.node.addEventListener('click', (event) => {
        active = newNode;
        update();
        event.stopPropagation();
    });
    newNode.node.addEventListener('dblclick', (event) => {
        active = newNode;
        replace = !replace;
        update();
        event.stopPropagation();
    });
    return newNode;
}

let expressionRoot = newNode(newExpression());
document.getElementById("expression").append(expressionRoot.node);


let active = expressionRoot;
let replace = false;

function update() {
    expressionRoot.getNode();
    for (const node of document.querySelectorAll('.active')) {
        node.classList.remove('active');
    }
    for (const node of document.querySelectorAll('.replace')) {
        node.classList.remove('replace');
    }
    active.node.classList.add(replace ? 'replace' : 'active');
    const node = document.getElementById("answer");
    node.innerHTML = '' + expressionRoot.expression;

    const subAnswer = document.getElementById("sub-answer");
    if (active) {
        subAnswer.innerHTML = '' + active.expression;
    } else {
        subAnswer.innerHTML = '';
    }
}

update();

function pushValue() {
    stack.unshift(value);
}

function openBrace(event) {
    update();
}
function closeBrace(event) {
    update();
}

function changeMode(event) {
    replace = !replace
    update();
}

function up(event) {
    if (active.parent) {
        active = active.parent;
    }
    update();
}

function down(event) {
    if (active.expression.input[0]) {
        active = active.expression.input[0];
    }
    update();
}

function left(event) {
    let node = active;
    const leaf = node.expression.input === undefined || node.expression.input.length === 0;
    while (node.parent) {
        const index = node.parent.expression.input.indexOf(node) - 1;
        if (index > -1) {
            active = node = node.parent.expression.input[index];
            break;
        }
        node = node.parent;
    }
    if (leaf) {
        while (node.expression.input && node.expression.input.length && !node.collapsed) {
            node = node.expression.input[node.expression.input.length - 1];
        }
        active = node;
    }
    update();
}

function right(event) {
    let node = active;
    const leaf = node.expression.input === undefined || node.expression.input.length === 0;
    while (node.parent) {
        const index = node.parent.expression.input.indexOf(node) + 1;
        if (index < node.parent.expression.input.length) {
            active = node = node.parent.expression.input[index];
            break;
        } else {
            node = node.parent;
        }
    }
    if (leaf) {
        while (node.expression.input && node.expression.input.length && !node.collapsed) {
            node = node.expression.input[0];
        }
        active = node;
    }
    update();
}

function sign(event) {
    if (active.expression.name === 'negate') {
        active.expression = active.expression.input[0].expression;
    } else {
        unaryOperator(
            'negate',
            (value) => -value,
            (str) => `-${str}`,
            '-', '');
    }
    update();
}
function square(event) {
    power(event)
    active.expression.value = 2;
    update();
}
function cube(event) {
    power(event)
    active.expression.value = 3;
    update();
}
function power(event) {
    const symbol = document.createElement('span');
    symbol.innerHTML = ' &#xD7; ';
    const expression = binaryOperator(
        'power',
        (value1, value2) => Math.pow(value1, value2),
        (str1, str2) => `${str1} &#xD7; ${str2}`,
        '(', symbol, ')');
    Object.assign(expression, {htmlNodes() {
            const fragment = document.createDocumentFragment();
            fragment.append(this.input[0].getNode());
            const pow = document.createElement('sup');
            fragment.append(pow);
            pow.append(this.input[1].getNode());
            return fragment;
        },});
    active = active.expression.input[1];
    update();
}
function squareRoot(event) {
    const symbol = document.createElement('span');
    symbol.innerHTML = '&#8730(';
    unaryOperator(
        'square root',
        (value) => Math.sqrt(value),
        (str) => `&#8730(${str})`,
        symbol, ')');
    update();
}
function cubeRoot(event) {
    root(event)
    active.expression.value = 3;
    update();
}
function root(event) {
    const symbol = document.createElement('span');
    symbol.innerHTML = ' &#xD7; ';
    const expression = binaryOperator(
        'root',
        (value1, value2) => precision(Math.exp(Math.log(value1) / value2), 14),
        (str1, str2) => `root(${str1}, ${str2})`,
        '(', symbol, ')');
    Object.assign(expression, {htmlNodes() {
            const fragment = document.createDocumentFragment();
            const pow = document.createElement('sup');
            fragment.append(pow);
            pow.append(this.input[1].getNode());
            const symbol = document.createElement('span');
            fragment.append(symbol);
            symbol.innerHTML = '&#8730';
            fragment.append(this.input[0].getNode());
            return fragment;
        },});
    active = active.expression.input[1];
    update();
}
function deg(event) {
    if (active.expression.name !== 'radians') {
        const symbol = document.createElement('span');
        symbol.innerHTML = '&deg;';
        unaryOperator(
            'radians',
            (value) => value * Math.PI / 180,
            (str) => `${str}&deg;`,
            '', symbol);
    }
    update();
}
function adeg(event) {
    unaryOperator(
        'degrees',
        (value) => value * 180 / Math.PI,
        (str) => `degrees(${str})`,
        'degrees(', ')');
    update();
}
function sin(event) {
    if (altMode) {
        altMode = false;
        const symbol = document.createElement('span');
        symbol.innerHTML = 'sin<sup>-1</sup>(';
        unaryOperator(
            'inverse sine',
            (value) => precision(Math.asin(value), 14),
            (str) => `asin(${str})`,
            symbol, ')');
        if (angleUnits === 'deg') {
            adeg(event);
        }
    } else {
        if (angleUnits === 'deg' && active.expression.value !== null) {
            deg(event);
        }
        unaryOperator(
            'sine',
            (value) => precision(Math.sin(value), 14),
            (str) => `sin(${str})`,
            'sin(', ')');
        if (angleUnits === 'deg' && active.expression.value === null) {
            deg(event);
        }
    }
    update();
}
function cos(event) {
    if (angleUnits === 'deg' && active.expression.value !== null) {
        deg(event);
    }
    unaryOperator(
        'cosine',
        (value) => precision(Math.cos(value), 14),
        (str) => `cos(${str})`,
        'cos(', ')');

    if (angleUnits === 'deg' && active.expression.value === null) {
        deg(event);
    }
    update();
}
function tan(event) {
    if (angleUnits === 'deg' && active.expression.value !== null) {
        deg(event);
    }
    unaryOperator(
        'tan',
        (value) => precision(Math.tan(value), 14),
        (str) => `tan(${str})`,
        'tan(', ')');
    if (angleUnits === 'deg' && active.expression.value === null) {
        deg(event);
    }
    update();
}
function sinh(event) {
    unaryOperator(
        'hyperbolic sine',
        (value) => Math.sinh(value),
        (str) => `sinh(${str})`,
        'sinh(', ')');
    update();
}
function cosh(event) {
    unaryOperator(
        'hyperbolic cosine',
        (value) => Math.cosh(value),
        (str) => `cosh(${str})`,
        'cosh(', ')');
    update();
}
function tanh(event) {
    unaryOperator(
        'hyperbolic tan',
        (value) => Math.tanh(value),
        (str) => `tanh(${str})`,
        'tanh(', ')');
    update();
}
function ln(event) {
    unaryOperator(
        'natural log',
        (value) => Math.log(value),
        (str) => `ln(${str})`,
        'ln(', ')');
    update();
}
function exp(event) {
    const expression = unaryOperator(
        '10 to the power of x',
        (value) => Math.pow(10, value),
        (str) => `10 ** (${str})`,
        '10 ** (', ')');
    Object.assign(expression, {htmlNodes() {
        const fragment = document.createDocumentFragment();
        fragment.append('10');
        const pow = document.createElement('sup');
        fragment.append(pow);
        pow.append(this.input[0].getNode());
        return fragment;
    },});
    update();
}
function log(event) {
    unaryOperator(
        'log',
        (value) => Math.log10(value),
        (str) => `log(${str})`,
        'log(', ')');
    update();
}
function EE(event) {
    binaryOperator(
        'divide',
        (value1, value2) => value1 * Math.pow(10, value2),
        (str1, str2) => `${str1}E${str2}`,
        '', 'E', '');
    active = active.expression.input[1];
    update();
}

function inv(event) {
    const symbol = document.createElement('span');
    symbol.innerHTML = ' &#xF7; ';
    binaryOperator(
        'divide',
        (value1, value2) => value1 / value2,
        (str1, str2) => `${str1} &#xF7; ${str2}`,
        '(', symbol, ')');
    [active.expression.input[0], active.expression.input[1]] = [active.expression.input[1], active.expression.input[0]]
    active.expression.input[0].expression.value = 1;
    active = active.expression.input[1];
    update();
}
function e(event) {
    const expression = unaryOperator(
        'e to the power of x',
        (value) => Math.exp(value),
        (str) => `e ** (${str})`,
        'e ** (', ')');
    Object.assign(expression, {htmlNodes() {
        const fragment = document.createDocumentFragment();
        fragment.append('e');
        const pow = document.createElement('sup');
        fragment.append(pow);
        pow.append(this.input[0].getNode());
        return fragment;
    },});
    update();
}
function alt(event) {
    altMode = !altMode;
}
function changeAngleUnits(event) {
    node = document.getElementById("angle");
    if (angleUnits === 'deg') {
        angleUnits = 'rad';
        angleScale = 1;
    } else if (angleUnits === 'rad') {
        angleUnits = 'gra';
        angleScale = Math.PI / 200;
    } else{
        angleUnits = 'deg';
        angleScale = Math.PI / 180;
    }
    console.log(angleUnits);
    node.innerHTML = angleUnits;
}
function pi(event) {
    active.expression = {
        name: 'pi',
        input: [],
        evaluate() {
            return Math.PI;
        },
        valueOf() {
            return this.evaluate();
        },
        asString() {
            return `PI`;
        },
        htmlNodes() {
            const fragment = document.createDocumentFragment();
            const pi = document.createElement('span');
            fragment.append(pi);
            pi.innerHTML = '&pi;';
            return fragment;
        },
    }
    update();
}

function del(event) {
    if (active.expression.input[0]) {
        active.expression = active.expression.input[0].expression;
    } else {
        if (active.expression.decimal) {
            active.expression.decimal -= 1;
            const pow = Math.pow(10, active.expression.decimal - 1);
            active.expression.value = Math.trunc(pow * active.expression.value) / pow;
        } else {
            active.expression.value = Math.trunc(active.expression.value / 10);
        }
    }
    replace = false;
    update();
}

function clear(event) {
    expressionRoot = newNode();
    active = expressionRoot;
    replace = false;
    const expressionNode = document.getElementById("expression");
    expressionNode.innerHTML = '';
    expressionNode.append(expressionRoot.node);
    update();
}
function percent(event) {
    update();
}
function divide(event) {
    const symbol = document.createElement('span');
    symbol.innerHTML = ' &#xF7; ';
    binaryOperator(
        'divide',
        (value1, value2) => value1 / value2,
        (str1, str2) => `${str1} &#xF7; ${str2}`,
        '(', symbol, ')');
    active = active.expression.input[1];
    update();
}
function multiply(event) {
    const symbol = document.createElement('span');
    symbol.innerHTML = ' &#xD7; ';
    binaryOperator(
        'multiply',
        (value1, value2) => value1 * value2,
        (str1, str2) => `${str1} &#xD7; ${str2}`,
        '(', symbol, ')');
    active = active.expression.input[1];
    update();
}
function minus(event) {
    binaryOperator(
        'subtract',
        (value1, value2) => value1 - value2,
        (str1, str2) => `${str1} - ${str2}`,
        '(', ' - ', ')');
    active = active.expression.input[1];
    update();
}
function plus(event) {
    binaryOperator(
        'add',
        (value1, value2) => value1 + value2,
        (str1, str2) => `${str1} + ${str2}`,
        '(', ' + ', ')');
    active = active.expression.input[1];
    update();
}

function equal(event) {
    binaryOperator(
        'equal',
        (value1, value2) => value1.valueOf() == value2.valueOf(),
        (str1, str2) => `${str1} = ${str2}`,
        '(', ' = ', ')');
    active = active.expression.input[1];
    update();
}

function collapse(event) {
    if (active.expression.input && active.expression.input.length) {
        active.collapsed = !active.collapsed;
    }
    replace = false;
    update();
}

function enter(event) {
    active = expressionRoot;
    replace = false;
    update();
}

function point(event) {
    if (!active.expression.decimal) {
        active.expression.decimal = 1;
        update();
    }
}

const digit = (value) => (event) => {
    active.expression.addDigit(value);
    update();
};

function addButtonActions() {
    const buttons = {
   status: {node: document.getElementById("status") },
   collapse: {node: document.getElementById("collapse"), action: collapse },
   edit: {node: document.getElementById("edit"), action: changeMode },
   up: {node: document.getElementById("up"), action: up },
   down: {node: document.getElementById("down"), action: down },
   left: {node: document.getElementById("left"), action: left },
   right: {node: document.getElementById("right"), action: right },
   openBrace: {node: document.getElementById("open-brace"), action: openBrace },
   closeBrace: {node: document.getElementById("close-brace"), action: closeBrace },
   sign: {node: document.getElementById("sign"), action: sign },
   square: {node: document.getElementById("square"), action: square },
   cube: {node: document.getElementById("cube"), action: cube },
   power: {node: document.getElementById("power"), action: power },
   squareRoot: {node: document.getElementById("square-root"), action: squareRoot },
   cubeRoot: {node: document.getElementById("cube-root"), action: cubeRoot },
   root: {node: document.getElementById("root"), action: root },
   sin: {node: document.getElementById("sin"), action: sin },
   cos: {node: document.getElementById("cos"), action: cos },
   tan: {node: document.getElementById("tan"), action: tan },
   sinh: {node: document.getElementById("sinh"), action: sinh },
   cosh: {node: document.getElementById("cosh"), action: cosh },
   tanh: {node: document.getElementById("tanh"), action: tanh },
   ln: {node: document.getElementById("ln"), action: ln },
   exp: {node: document.getElementById("exp"), action: exp },
   log: {node: document.getElementById("log"), action: log },
   EE: {node: document.getElementById("ee"), action: EE },
   inv: {node: document.getElementById("inv"), action: inv },
   e: {node: document.getElementById("e"), action: e },
   alt: {node: document.getElementById("alt"), action: alt },
   angle: {node: document.getElementById("angle"), action: changeAngleUnits },
   pi: {node: document.getElementById("pi"), action: pi },

   clear: {node: document.getElementById("clear"), action: clear },
   del: {node: document.getElementById("del"), action: del },

   percent: {node: document.getElementById("percent"), action: percent },
   divide: {node: document.getElementById("divide"), action: divide },
   multiply: {node: document.getElementById("multiply"), action: multiply },

   minus: {node: document.getElementById("minus"), action: minus },
   plus: {node: document.getElementById("plus"), action: plus },

   equal: {node: document.getElementById("equal"), action: equal },
   enter: {node: document.getElementById("enter"), action: enter },

   decimal: {node: document.getElementById("decimal"), action: point },

   zero: {node: document.getElementById("zero"), action: digit(0) },
   one: {node: document.getElementById("one"), action: digit(1) },
   two: {node: document.getElementById("two"), action: digit(2) },
   three: {node: document.getElementById("three"), action: digit(3) },
   four: {node: document.getElementById("four"), action: digit(4) },
   five: {node: document.getElementById("five"), action: digit(5) },
   six: {node: document.getElementById("six"), action: digit(6) },
   seven: {node: document.getElementById("seven"), action: digit(7) },
   eight: {node: document.getElementById("eight"), action: digit(8) },
   nine: {node: document.getElementById("nine"), action: digit(9) },
   }

   Object.values(buttons).filter((button) => button.action).forEach((button) => {
       button.node.addEventListener('click', button.action);
   });
}

function addKeyActions() {
    const keys = {
   '0': {action: digit(0) },
   '1': {action: digit(1) },
   '2': {action: digit(2) },
   '3': {action: digit(3) },
   '4': {action: digit(4) },
   '5': {action: digit(5) },
   '6': {action: digit(6) },
   '7': {action: digit(7) },
   '8': {action: digit(8) },
   '9': {action: digit(9) },
   }

   document.body.addEventListener('keydown', (event) => {
       const action = keys[event.key];
       if (action) {
           action(event);
       }
   });

}
</script>
</body>
</html>
